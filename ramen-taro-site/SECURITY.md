# セキュリティガイド

## Sanity Studio アクセス制御

このプロジェクトでは、本番環境でのSanity Studioへの不正アクセスを防ぐため、以下のセキュリティ対策を実装しています。

### 1. ナビゲーションからStudioリンクを除去

- ヘッダーナビゲーションからStudioリンクを削除
- 一般ユーザーがStudioにアクセスできないようにUI上で制限

### 2. ミドルウェアによるアクセス制御

本番環境では、以下の条件でのみStudioにアクセス可能です：

#### 開発環境でのアクセス
- `NODE_ENV=development` の場合
- `localhost` または `127.0.0.1` からのアクセス

#### 本番環境でのアクセス
- 管理者キーが必要: `https://yourdomain.com/studio?admin=YOUR_SECRET_KEY`

### 3. 環境変数の設定

`.env.local` ファイルに以下を設定してください：

```env
# 管理者アクセス用の秘密キー（強力なランダム文字列を設定）
STUDIO_ADMIN_KEY=your-very-secret-admin-key-here
```

### 4. 本番環境でのStudioアクセス方法

1. **環境変数を設定**
   ```
   STUDIO_ADMIN_KEY=your-secret-key
   ```

2. **URLにクエリパラメータを追加してアクセス**
   ```
   https://yourdomain.com/studio?admin=your-secret-key
   ```

### 5. セキュリティのベストプラクティス

- `STUDIO_ADMIN_KEY` は32文字以上の強力なランダム文字列を使用
- 定期的にキーを変更する
- アクセスログを監視する
- 必要に応じてIP制限も追加検討

### 6. 緊急時の対応

不正アクセスが疑われる場合：

1. 即座に `STUDIO_ADMIN_KEY` を変更
2. Sanityプロジェクトのアクセストークンを無効化
3. アクセスログを確認
4. 必要に応じてコンテンツを復旧

## 注意事項

- 管理者キーは絶対に公開リポジトリにコミットしないでください
- チーム内でキーを共有する際は安全な方法を使用してください
- 定期的にセキュリティ設定を見直してください