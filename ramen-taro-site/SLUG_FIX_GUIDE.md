# スラッグ修正ガイド

## 🚨 現在の問題

Sanityデータベースのブログ記事で、スラッグフィールドに完全なURL（`https://ramen-taro.com/blog/hamcup-story`）が保存されており、正しいスラッグ（`hamcup-story`）ではないため404エラーが発生しています。

## 🔧 修正方法

### 1. **Sanity Studio での手動修正**

#### 手順：
1. **Sanity Studio にアクセス**: http://localhost:3333
2. **記事一覧から問題の記事を選択**
3. **スラッグフィールドを確認**
4. **以下のように修正**:

**修正前**（問題あり）:
```
https://ramen-taro.com/blog/hamcup-story
```

**修正後**（正しい形式）:
```
hamcup-story
```

#### 修正対象の記事：
- 「絵を描いたことのなかった僕が、ファンアートに挑戦した話」

### 2. **自動修正機能の実装済み**

コードレベルで以下の改善を実装済みです：

- **強化されたスラッグ正規化関数**
- **URL形式の自動検出・修正**
- **エラーハンドリングの改善**

### 3. **修正確認方法**

1. **Sanity Studioでスラッグを修正**
2. **キャッシュ更新**: http://localhost:3000/api/manual-revalidate?key=manual-update
3. **サイトで動作確認**: http://localhost:3000

## 📋 具体的な修正手順

### Step 1: Sanity Studio でのスラッグ修正

```bash
# Sanity Studio にアクセス
http://localhost:3333
```

1. **Content タブを選択**
2. **Post をクリック**
3. **問題の記事を開く**（「絵を描いたことのなかった僕が、ファンアートに挑戦した話」）
4. **Slug フィールドを確認**
5. **以下に変更**:
   - 現在: `https://ramen-taro.com/blog/hamcup-story`
   - 変更後: `hamcup-story`
6. **保存**

### Step 2: キャッシュ更新

```bash
# ブラウザで以下のURLにアクセス
http://localhost:3000/api/manual-revalidate?key=manual-update
```

### Step 3: 動作確認

```bash
# サイトにアクセスして確認
http://localhost:3000
```

1. **ホームページの「Latest Articles」セクションを確認**
2. **「続きを読む」をクリック**
3. **正しく記事ページに遷移することを確認**

## 🛡️ 今後の予防策

### 1. **スラッグ入力時の注意**
- **正しい形式**: `article-title`
- **避けるべき**: 完全なURL、スラッシュを含む文字列

### 2. **Sanity Schema の改善**
今後、以下のバリデーションルールを追加予定：
- URL形式の禁止
- 適切なスラッグ形式の強制

### 3. **自動修正機能**
実装済みの機能により、既存の不正なスラッグも自動的に正規化されます。

## ⚠️ 注意事項

- **本番環境**: 本番環境でも同様の修正が必要です
- **SEO影響**: スラッグ変更はSEOに影響する場合があります
- **リンク切れ**: 外部からの直接リンクが切れる可能性があります

## 🆘 トラブルシューティング

### スラッグ修正後も404エラーが続く場合：

1. **ブラウザキャッシュクリア**
2. **手動キャッシュ更新の再実行**
3. **開発サーバーの再起動**: `npm run dev`

### Sanity Studio にアクセスできない場合：

```bash
# Sanity Studio を起動
cd sanity
npm run dev
```

このガイドに従って修正すれば、「続きを読む」ボタンが正常に動作するようになります。